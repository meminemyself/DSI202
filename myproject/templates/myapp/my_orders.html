{% extends 'base.html' %}
{% block title %}à¸„à¸³à¸ªà¸±à¹ˆà¸‡à¸‹à¸·à¹‰à¸­à¸‚à¸­à¸‡à¸‰à¸±à¸™ | PLOOKJING{% endblock %}

{% block content %}
<link href="https://fonts.googleapis.com/css2?family=Prompt:wght@400;600&display=swap" rel="stylesheet">
<style>
  body {
    font-family: 'Prompt', sans-serif;
    background-color: #F3F6F9;
  }
  .orders-page {
    max-width: 1080px;
    margin: 2rem auto;
    padding: 2rem;
  }
  .orders-header {
    font-size: 2rem;
    font-weight: bold;
    color: #0D3F31;
    margin-bottom: 1.5rem;
  }
  .status-filter {
    display: flex;
    gap: 0.8rem;
    flex-wrap: wrap;
    margin-bottom: 2rem;
  }
  .status-tab {
    padding: 0.6rem 1.2rem;
    background: #E6F4EC;
    color: #0D6E3E;
    border-radius: 8px;
    font-weight: 600;
    text-decoration: none;
    transition: 0.3s ease;
    border: 2px solid transparent;
  }
  .status-tab:hover {
    background: #CCE9DB;
  }
  .status-tab.active {
    background: #FB7E2B;
    color: white;
    border-color: #FB7E2B;
  }
  .order-list {
    display: flex;
    flex-direction: column;
    gap: 1rem;
  }
  .order-item {
    background: white;
    padding: 1rem 1.2rem;
    border-radius: 14px;
    box-shadow: 0 4px 10px rgba(0,0,0,0.04);
    display: flex;
    align-items: center;
    justify-content: space-between;
    cursor: pointer;
    border-left: 6px solid #EFFAF3;
    transition: 0.2s ease;
  }
  .order-item:hover {
    background-color: #FAFFFC;
  }
  .order-item img {
    width: 80px;
    height: 80px;
    object-fit: cover;
    border-radius: 10px;
    margin-right: 1rem;
  }
  .order-summary {
    display: flex;
    align-items: center;
    flex: 1;
    gap: 1rem;
  }
  .order-info h4 {
    font-size: 1rem;
    margin: 0;
    color: #0D3F31;
  }
  .order-info p {
    font-size: 0.9rem;
    margin: 0.2rem 0 0;
    color: #666;
  }
  .order-status {
    font-weight: bold;
    font-size: 0.95rem;
    padding: 0.3rem 0.6rem;
    border-radius: 6px;
    display: inline-block;
  }
  .status-pending { background: #FFF1E5; color: #FB7E2B; }
  .status-preparing { background: #FFF9DB; color: #B28A00; }
  .status-shipping { background: #E0F2FF; color: #0277BD; }
  .status-delivered { background: #E6F4EC; color: #0D6E3E; }
  .status-cancelled, .status-expired { background: #FFECEC; color: #D55E02; }
  .modal {
    display: none;
    position: fixed;
    z-index: 1000;
    left: 0; top: 0;
    width: 100%; height: 100%;
    background-color: rgba(0, 0, 0, 0.4);
  }
  .modal-content {
    background-color: #fff;
    margin: 5% auto;
    padding: 2rem;
    border-radius: 14px;
    max-width: 540px;
    position: relative;
    font-family: 'Prompt', sans-serif;
  }
  .close {
    position: absolute;
    top: 0.8rem;
    right: 1rem;
    font-size: 2.2rem;
    color: #999;
    cursor: pointer;
  }
  .action-btn {
    display: inline-block;
    padding: 0.5rem 1rem;
    border-radius: 10px;
    font-size: 0.9rem;
    margin: 0.3rem 0.2rem 0;
    font-weight: 600;
    text-decoration: none;
    font-family: 'Prompt', sans-serif;
    border: none;
  }
  .btn-slip { background: #FFF1E5; color: #FB7E2B; cursor: pointer; }
  .btn-cancel { background: #FFECE8; color: #D55E02; }
</style>

<div class="orders-page">
  <div class="orders-header">à¸„à¸³à¸ªà¸±à¹ˆà¸‡à¸‹à¸·à¹‰à¸­à¸‚à¸­à¸‡à¸‰à¸±à¸™</div>
  <div class="status-filter">
    {% for status, label, css_class in status_list %}
      <a href="?status={{ status }}" class="status-tab {% if request.GET.status == status %}active{% endif %}">{{ label }}</a>
    {% endfor %}
  </div>
  <div class="order-list">
    {% for order in purchases %}
      <div class="order-item" onclick="openModal('{{ order.id }}')">
        <div class="order-summary">
          <img src="{{ order.equipment.image_url }}" alt="{{ order.equipment.name }}">
          <div class="order-info">
            <h4>{{ order.equipment.name }}</h4>
            <p>x {{ order.quantity }}</p>
            <p class="order-status status-{{ order.status }}">à¸ªà¸–à¸²à¸™à¸°: {{ order.get_status_display }}</p>
          </div>
        </div>
        <div>&rsaquo;</div>
      </div>

      <div id="modal-{{ order.id }}" class="modal">
        <div class="modal-content">
          <span class="close" onclick="closeModal('{{ order.id }}')">&times;</span>
          <h3>ðŸ“„ à¸£à¸²à¸¢à¸¥à¸°à¹€à¸­à¸µà¸¢à¸”à¸„à¸³à¸ªà¸±à¹ˆà¸‡à¸‹à¸·à¹‰à¸­</h3>

          <h4 style="margin-top: 1rem; color: #0D3F31;">ðŸ›’ à¸ªà¸´à¸™à¸„à¹‰à¸²</h4>
          <p><strong>{{ order.equipment.name }}</strong></p>
          <p>à¸ˆà¸³à¸™à¸§à¸™: {{ order.quantity }} à¸Šà¸´à¹‰à¸™</p>
          <p>à¸£à¸²à¸„à¸²à¸•à¹ˆà¸­à¸Šà¸´à¹‰à¸™: {{ order.equipment.price|floatformat:2 }} à¸šà¸²à¸—</p>
          <p><strong>à¸¢à¸­à¸”à¸£à¸§à¸¡:</strong> {{ order.total_price|floatformat:2 }} à¸šà¸²à¸—</p>

          <h4 style="margin-top: 1.2rem; color: #0D3F31;">ðŸ“¦ à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸œà¸¹à¹‰à¸£à¸±à¸šà¸ªà¸´à¸™à¸„à¹‰à¸²</h4>
          <p>{{ order.name }} | {{ order.tel }}</p>
          <p>{{ order.address }}</p>

          <h4 style="margin-top: 1.2rem; color: #0D3F31;">ðŸ“… à¸§à¸±à¸™à¸—à¸µà¹ˆà¸ªà¸±à¹ˆà¸‡à¸‹à¸·à¹‰à¸­</h4>
          <p>{{ order.created_at|date:'d/m/Y à¹€à¸§à¸¥à¸² H:i' }}</p>

          {% if order.tracking_number and order.status in 'shipping delivered' %}
            <h4 style="margin-top: 1.2rem; color: #0D3F31;">ðŸšš à¸«à¸¡à¸²à¸¢à¹€à¸¥à¸‚à¸žà¸±à¸ªà¸”à¸¸</h4>
            <p>{{ order.tracking_number }}</p>
          {% endif %}

          {% if order.payment_slip and order.status in 'preparing shipping delivered' %}
            <h4 style="margin-top: 1.2rem; color: #0D3F31;">ðŸ’³ à¸ªà¸¥à¸´à¸›à¸Šà¸³à¸£à¸°à¹€à¸‡à¸´à¸™</h4>
            <a href="{{ order.payment_slip.url }}" target="_blank" class="action-btn btn-slip">à¸”à¸¹à¸ªà¸¥à¸´à¸›</a>
          {% endif %}
        </div>
      </div>
    {% empty %}
      <p class="text-gray-500">à¹„à¸¡à¹ˆà¸¡à¸µà¸„à¸³à¸ªà¸±à¹ˆà¸‡à¸‹à¸·à¹‰à¸­à¹ƒà¸™à¸«à¸¡à¸§à¸”à¸™à¸µà¹‰</p>
    {% endfor %}
  </div>
</div>

<script>
  function openModal(id) {
    document.getElementById('modal-' + id).style.display = 'block';
  }
  function closeModal(id) {
    document.getElementById('modal-' + id).style.display = 'none';
  }
</script>
{% endblock %}
